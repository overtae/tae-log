---
title: 'TCP 3, 4 way handshake'
date: '2022-11-06'
description: 'TCP μ—°κ²° μƒμ„±κ³Ό ν•΄μ  λ°©μ‹'
tags:
  - 'TCP'
---

## κ°μ”

μ΄μ „ ν¬μ¤ν…μ—μ„ TCPλ” **3 way handshakeλ΅ μ—°κ²°μ„ μƒμ„±**ν•κ³  **4 way handshakeλ΅ ν•΄μ **ν•λ‹¤λ” κ²ƒμ„ μ•κ²λμ—λ‹¤. μ΄λ²μ—λ” μ΄ λ‘μ— λ€ν•΄ μ΅°κΈ λ” μμ„Έν•κ² μ•μ•„λ³΄λ„λ΅ ν•μ.

..κ·Έ μ „μ— ν¬νΈ μƒνƒ μ •λ³΄μ™€ ν”λκ·Έ μ •λ³΄ λ¨Όμ € μ•μ•„λ³΄μ.

## PORT State μ •λ³΄

|             |                                                                                       |
| ----------- | ------------------------------------------------------------------------------------- |
| CLOSED      | ν¬νΈκ°€ λ‹«ν μƒνƒ                                                                      |
| LISTEN      | ν¬νΈκ°€ μ—΄λ¦° μƒνƒ, μ—°κ²° μ”μ²­ λ€κΈ° μ¤‘                                                   |
| SYN_RECV    | SYNC μ”μ²­μ„ λ°›κ³  μƒλ€λ°©μ μ‘λ‹µμ„ κΈ°λ‹¤λ¦¬λ” μ¤‘                                          |
| ESTABLISHED | ν¬νΈ μ—°κ²° μƒνƒ                                                                        |
| TIME_WAIT   | μ„λ²„λ΅λ¶€ν„° FINμ„ μμ‹ ν•λ”λΌλ„ μΌμ • μ‹κ°„λ™μ• μ„Έμ…μ„ λ‚¨κ²¨λ†“κ³  μ‰μ—¬ ν¨ν‚·μ„ κΈ°λ‹¤λ¦¬λ” κ³Όμ • |

## Flag μ •λ³΄

TCP ν—¤λ”μ—λ” CONTROL BIT(ν”λκ·Έ λΉ„νΈ)κ°€ μ΅΄μ¬ν•λ©°, κ°κ°μ λΉ„νΈλ” `URG-ACK-PSH-RST_FIN`μ„ μλ―Έν•λ‹¤.

|                                         |                                                                                                                                |
| --------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| URG<br/>Urgent                          | κΈ΄κΈ‰ν μ²λ¦¬ ν•λΌλ” μλ―Έ, URGκ°€ μ„¤μ •μ΄ λμ–΄μλ‹¤λ©΄ ν•΄λ‹Ή λ°μ΄ν„°λ¶€ν„° μ²λ¦¬.                                                         |
| ACK<br/>Acknowledgement                 | μ‘λ‹µ ν™•μΈ, ν¨ν‚·μ„ λ°›μ•λ‹¤λ” κ²ƒμ„ μλ―Έ. ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚Έ μµμ΄μ SYN ν¨ν‚· μ΄ν›„μ— μ „μ†΅λλ” λ¨λ“  ν¨ν‚·μ€ μ΄ ν”λκ·Έκ°€ μ„¤μ •λμ–΄μ•Ό ν•¨. |
| PSH<br/>Push                            | Push ν•¨μ, λ©”λ¨λ¦¬ μμ›μ΄ λ‹¤ μ°¨μ§€ μ•μ•„λ„ λ°μ΄ν„°λ¥Ό λμ Έμ¤. μ£Όλ΅ URGμ™€ ν•¨κ» μ‚¬μ©.                                                 |
| RST<br/>Reset                           | ν„μ¬ μ„Έμ…μ— μν•΄ ν• λ‹Ήλ λ©”λ¨λ¦¬ μμ›μ„ Null μƒνƒλ΅ λ§λ“¤μ–΄ μ‹μ¤ν…μ— λ°λ‚©ν•λΌλ” μλ―Έ                                              |
| SYN<br/>Synchronization Sequence Number | μ—°κ²° μ„¤μ • μ”κµ¬, Synchronization Sequence Number(λ™κΈ°ν™” μμ„ λ²νΈ)λ¥Ό λλ¤μΌλ΅ μ„¤μ •ν•μ—¬ μ„Έμ… μ—°κ²°, μ΄κΈ°μ— Sequence Number μ „μ†΅   |
| FIN<br/>Finish                          | μ—°κ²° ν•΄μ , μ„Έμ… μ—°κ²° μΆ…λ£, λ” μ΄μƒ μ „μ†΅ν•  λ°μ΄ν„°κ°€ μ—†μμ„ μλ―Έ (4 way handwhakeμ—μ„ μ‚¬μ©)                                      |

## TCP 3 way handshake

TCP ν†µμ‹  μ΄μ©μ‹, λ°μ΄ν„°λ¥Ό μ „μ†΅ν•κΈ° μ„ν•΄ **λ„¤νΈμ›ν¬ μ—°κ²°μ„ μ„¤μ •ν•λ” κ³Όμ •**μΌλ΅ 3λ²μ ν™•μΈ κ³Όμ •μ„ κ±°μΉλ‹¤κ³  ν•΄μ„ 3 way handshake λΌκ³  λ¶€λ¥Έλ‹¤. μ¦‰, λ°μ΄ν„°λ¥Ό μ „μ†΅ν•κΈ° μ „μ— λ¨Όμ € **μ •ν™•ν• μ „μ†΅μ„ λ³΄μ¥**ν•κΈ° μ„ν•΄ μƒλ€λ°© μ»΄ν“¨ν„°μ™€ μ‚¬μ „μ— μ„Έμ…μ„ μλ¦½ν•λ” κ³Όμ •μ΄λ‹¤.

### λ™μ‘ λ°©μ‹

![tcpipguide.com](/posts/computer-science/network/handshake-01.png "http://www.tcpipguide.com/free/t_TCPConnectionEstablishmentProcessTheThreeWayHandsh-3.htm")

μμ–΄λ¥Ό μ λ°λΌμ„ κ·Έλ°μ§€ λμ— μ λ“¤μ–΄μ¤μ§€λ” μ•λ”λ‹¤. μ •λ¦¬ν•μλ©΄ μ•„λμ™€ κ°™λ‹¤.

μ°μ„ , μ²μμ—λ” ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ λ¨λ‘ CLOSED μƒνƒμ΄λ‹¤.

#### 1. ν΄λΌμ΄μ–ΈνΈ β†’ SYN β†’ μ„λ²„

ν΄λΌμ΄μ–ΈνΈκ°€ Sequence Numberλ¥Ό μ„μμ μ«μλ΅ μ§€μ •ν•κ³ , SYN ν”λκ·Έλ¥Ό 1λ΅ μ„¤μ •ν• μ„Έκ·Έλ¨ΌνΈ μ „μ†΅

- ν΄λΌμ΄μ–ΈνΈ : SYN+ACK μ‘λ‹µμ„ κΈ°λ‹¤λ¦¬λ” SYN_SENT μƒνƒ
- μ„λ²„ : LISTEN μƒνƒ

#### 2. μ„λ²„ β†’ SYN+ACK β†’ ν΄λΌμ΄μ–ΈνΈ

μ„λ²„λ” SYNμ„ λ°›κ³ , ACK Number ν•„λ“λ¥Ό `Sequence Number + 1` λ΅ μ§€μ •ν•κ³  ACKμ™€ SYN ν”λκ·Έλ¥Ό 1λ΅ μ„¤μ •ν• μ„Έκ·Έλ¨ΌνΈ μ „μ†΅

- ν΄λΌμ΄μ–ΈνΈ : CLOSED μƒνƒ
- μ„λ²„ : ACK μ‘λ‹µμ„ κΈ°λ‹¤λ¦¬λ” SYN_RECEIVED μƒνƒ

#### 3. ν΄λΌμ΄μ–ΈνΈ β†’ ACK β†’ μ„λ²„

ν΄λΌμ΄μ–ΈνΈλ” SYN+ACK ν¨ν‚·μ„ λ°›κ³ , ACK(`Sequence Number + 1`) ν¨ν‚·μ„ μ „μ†΅

- ν΄λΌμ΄μ–ΈνΈ : ESTABLISHED μƒνƒ
- μ„λ²„ : ESTABLISHED μƒνƒ (ν¬νΈ μ—°κ²° μƒνƒ)

μ΄ν›„μ—” μ—°κ²°μ΄ μ΄λ£¨μ–΄μ Έ λ°μ΄ν„°κ°€ μ¤κ°€κ² λλ‹¤.

<Quote>

μ™ Sequence Numberλ¥Ό μ„μμ μ«μλ΅ μ§€μ •ν• κΉ?

</Quote>

μ΄μ „μ—λ” ν¬νΈ λ²νΈλ¥Ό μ¬μ‚¬μ©ν•¨μ— λ”°λΌ κ³Όκ±°μ— μ‚¬μ©λ ν¬νΈ λ²νΈ μμ„ μ‚¬μ©ν•λ” κ°€λ¥μ„±μ΄ μ΅΄μ¬ν–λ‹¤κ³  ν•λ‹¤. SYNμ΄ λ‚μκ°€ μ•„λ‹λΌλ©΄ μ„λ²„μ—μ„ μ΄μ „ μ—°κ²°λ΅λ¶€ν„° μ¤λ” ν¨ν‚·μΌλ΅ μΈμ‹ν•  μ μκΈ° λ•λ¬Έμ— λ‚μλ΅ μ„¤μ •ν•λ‹¤.

## TCP 4 way handshake

TCP ν†µμ‹  μ΄μ©μ‹, **μ—°κ²°μ„ ν•΄μ ν•  λ• μ‚¬μ©**ν•λ” κ³Όμ •μΌλ΅ 4λ²μ ν™•μΈ κ³Όμ •μ„ κ±°μΉλ‹¤κ³  ν•΄μ„ 4 way handshake λΌκ³  λ¶€λ¥Έλ‹¤.

### λ™μ‘ λ°©μ‹

![tcpipguide.com](/posts/computer-science/network/handshake-02.png "http://www.tcpipguide.com/free/t_TCPConnectionTermination-2.htm")

μ—­μ‹ μμ–΄λΌ μ•κΈ° μ–΄λ µλ‹¤. μ •λ¦¬ν•λ©΄ μ•„λμ™€ κ°™λ‹¤.

#### 1. ν΄λΌμ΄μ–ΈνΈ β†’ FIN β†’ μ„λ²„

ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—κ² μ—°κ²°μ„ μΆ…λ£ν•λ‹¤λ” FIN ν”λκ·Έλ¥Ό μ „μ†΅

#### 2. μ„λ²„ β†’ ACK β†’ ν΄λΌμ΄μ–ΈνΈ

μ„λ²„λ” FINμ„ λ°›κ³ , ACK Number ν•„λ“λ¥Ό `Sequence Number + 1` λ΅ μ§€μ •ν•κ³  ACK ν”λκ·Έ λΉ„νΈλ¥Ό 1λ΅ μ„¤μ •ν• μ„Έκ·Έλ¨ΌνΈ μ „μ†΅, μ„λ²„ μμ‹ μ ν†µμ‹ μ΄ λλ‚  λ•κΉμ§€ λ€κΈ° (TIME_WAIT)

- μ„λ²„ : ACK μ „μ†΅ μ΄ν›„ CLOSE_WAIT μƒνƒ, μ•„μ§ λ‚¨μ€ λ°μ΄ν„°κ°€ μλ‹¤λ©΄ λ§μ € μ „μ†΅ ν›„ `close()` νΈμ¶
- ν΄λΌμ΄μ–ΈνΈ : ACK λ°›μ€ μ΄ν›„ FIN_WAIT_2 μƒνƒ, μ„λ²„κ°€ FIN ν¨ν‚·μ„ λ³΄λ‚Ό λ•κΉμ§€ λ€κΈ°

#### 3. μ„λ²„ β†’ FIN β†’ ν΄λΌμ΄μ–ΈνΈ

μ„λ²„λ” λ°μ΄ν„°λ¥Ό λ¨λ‘ λ³΄λƒλ‹¤λ©΄ ν΄λΌμ΄μ–ΈνΈμ—κ² FIN ν¨ν‚· μ „μ†΅

- μ„λ²„ : FIN μ „μ†΅ μ΄ν›„ LASK_ACK μƒνƒ, μΉμΈ λ²νΈ λ€κΈ°

#### 4. ν΄λΌμ΄μ–ΈνΈ β†’ ACK β†’ μ„λ²„

ν΄λΌμ΄μ–ΈνΈλ” FINμ„ λ°›κ³ , μ„λ²„μ—κ² ACK μ „μ†΅

- ν΄λΌμ΄μ–ΈνΈ : TIME_WAIT μƒνƒ, μΌμ • μ‹κ°„ μ΄ν›„ CLOSED μƒνƒ

<Quote>

TIME_WAIT?

</Quote>

μ„λ²„μ—μ„ FINμ„ μ „μ†΅ν•κΈ° μ „μ— μ „μ†΅ν• ν¨ν‚·μ΄ λΌμ°ν… μ§€μ—°μ΄λ‚ ν¨ν‚· μ μ‹¤λ΅ μΈν• μ¬μ „μ†΅ λ“±μΌλ΅ μΈν•΄ FIN ν¨ν‚·λ³΄λ‹¤ λ¦κ² λ„μ°©ν•λ” μƒν™©μ΄ λ°μƒν•  μ μλ‹¤. μ΄λ¥Ό λ€λΉ„ν•κΈ° μ„ν•΄ ν΄λΌμ΄μ–ΈνΈλ” μΌμ • μ‹κ°„λ™μ• μ„Έμ…μ„ λ‚¨κ²¨λ†“κ³  μ‰μ—¬ ν¨ν‚·μ„ κΈ°λ‹¤λ¦¬λ” κ³Όμ •μΈ TIME_WAITμ„ κ±°μΉλ‹¤. TIME-WAITμ΄ μ—†λ‹¤λ©΄ ν¨ν‚·μ μ†μ‹¤μ΄ λ°μƒν•κ±°λ‚ ν†µμ‹ μ κ°„ μ—°κ²° ν•΄μ κ°€ μ λ€λ΅ μ΄λ£¨μ–΄μ§€μ§€ μ•μ„ μ μλ‹¤.

μ΄λ¥Ό ν†µν•΄ μ—°κ²° μΆ…λ£ κ³Όμ •μ΄ μ—°κ²° μ„¤μ • κ³Όμ •λ³΄λ‹¤ ν• λ‹¨κ³„ λ” λ§μ€ μ΄μ λ” νΉμ‹ λ¨λ¥Ό λ‚¨μ•„μμ„ λ°μ΄ν„° λ•λ¬Έμ΄λΌλ” κ²ƒμ„ μ• μ μκ² λ‹¤.

## λ²μ™Έ

μ—°κ²°μ„ μ„¤μ •ν•κ³  ν•΄μ ν•λ” κ³Όμ •μ— λ€ν•΄ μ¬λ°κ² μ„¤λ…ν• κΈ€μ΄ μμ–΄μ„ κ°€μ Έμ™€λ΄¤λ‹¤.

### 3 way handshake

π‘© 1λ‹¨κ³„ : λ‚΄ λ§ λ“¤λ ¤?

π§‘ 2λ‹¨κ³„ : λ“¤λ ¤. λ„λ„ λ‚΄ λ§ λ“¤λ ¤?

π‘© 3λ‹¨κ³„ : λ“¤λ ¤.

### 4 way handshake

π‘© 1λ‹¨κ³„ : μ—°κ²° λκ³  μ‹¶μ–΄.

π§‘ 2λ‹¨κ³„ : ν™•μΈν–μ–΄. λ³΄λ‚΄λ κ±° λ§μ € λ³΄λ‚Όκ².

π§‘ 3λ‹¨κ³„ : λ‹¤ λ³΄λƒλ‹¤. μ—°κ²° λμ.

π‘© 3λ‹¨κ³„ : μ‘.

<Callout type="info" icon="π’΅">

μ΄ κ²μ‹λ¬Όμ€ [velog.io/@averycode](https://velog.io/@averycode/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-TCPUDP%EC%99%80-3-Way-Handshake4-Way-Handshake), [hyemsinabro.tistory.com](https://hyemsinabro.tistory.com/m/157) μ‚¬μ΄νΈλ¥Ό μ°Έκ³ ν•μ€μµλ‹λ‹¤.

</Callout>
